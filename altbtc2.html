<!DOCTYPE html>
<html>
<head>
    <title>BTC Exchange Rate</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 0 auto; /* 水平置中 */
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        .positive {
            color: green;
        }

        .negative {
            color: red;
        }
    </style>
</head>
<body>
    Reference: Binance
    <table>
        <thead>
            <tr>
				<th>Category</th>
                <th>Coin/Token</th>
                <th>Price with BTC</th>
                <th>Change Percentage </th>
            </tr>
        </thead>
        <tbody id="data">
            <!-- 這裡將插入動態生成的表格內容 -->
        </tbody>
    </table>

    <script>
        // 定義 API 函數
        function get_symbol_price(symbol) {
            const url = "https://api.binance.com/api/v3/ticker/24hr";
            const params = {
                "symbol": `${symbol}BTC`
            };

            return fetch(`${url}?${new URLSearchParams(params)}`)
                .then(response => response.json())
                .then(data => {
                    const price_change_percent = 'priceChangePercent' in data ? parseFloat(data['priceChangePercent']).toFixed(2) : null;
                    const last_price = 'lastPrice' in data ? parseFloat(data['lastPrice']) : null;
                    return [last_price, price_change_percent];
                })
                .catch(error => {
                    console.error(`Error fetching data for ${symbol}:`, error);
                    return [null, null];
                });
        }

        // 定義幣種列表和分類
        const symbols = [
            { symbol: 'ETH', category: '01) Chain' },
            { symbol: 'SOL', category: '01) Chain' },
            { symbol: 'BNB', category: '01) Chain' },
            { symbol: 'STX', category: '03) BTC L2' },
            { symbol: 'ORDI', category: '03) BTC L2' },
            { symbol: '1000SATS', category: '03) BTC L2' },
            { symbol: 'RIF', category: '03) BTC L2' },
            { symbol: 'ARB', category: '02) Layer 2' },
            { symbol: 'OP', category: '02) Layer 2' },
            { symbol: 'STRK', category: '02) Layer 2' },
            { symbol: 'XAI', category: '02) Layer 2' },
            { symbol: 'LINK', category: '04) Infrastructure' },
            { symbol: 'PYTH', category: '04) Infrastructure' },
            { symbol: 'TIA', category: '04) Infrastructure' },
            { symbol: 'BAND', category: '04) Infrastructure' },
            { symbol: 'FIL', category: '05) Storage' },
            { symbol: 'AR', category: '05) Storage' },
            { symbol: 'DOT', category: '06) Layer 0' },
            { symbol: 'ATOM', category: '06) Layer 0' },
            { symbol: 'BLUR', category: '09) NFT' },
            { symbol: 'UNI', category: '07) DeFi' },
            { symbol: 'DYDX', category: '07) DeFi' },
            { symbol: 'JUP', category: '07) DeFi' },
            { symbol: 'ALT', category: '04) Infrastructure' },
            { symbol: 'MANTA', category: '02) Layer 2' },
            { symbol: 'MATIC', category: '02) Layer 2' },
            { symbol: 'SUI', category: '01) Chain' },
            { symbol: 'APT', category: '01) Chain' },
            { symbol: 'SSV', category: '04) Infrastructure' },
            { symbol: 'WLD', category: '08) MEME' },
            { symbol: 'PENDLE', category: '07) DeFi' },
			{ symbol: 'AAVE', category: '07) DeFi' },
			{ symbol: 'MKR', category: '07) DeFi' },
			{ symbol: 'SNX', category: '07) DeFi' },
			{ symbol: 'INJ', category: '07) DeFi' },
            { symbol: 'PEPE', category: '08) MEME' },
            { symbol: 'DOGE', category: '08) MEME' },
            { symbol: 'BONK', category: '08) MEME' },
            { symbol: 'HMX', category: '12) Other' },
            { symbol: 'AVA', category: '12) Other' },
            { symbol: 'RNDR', category: '12) Other' },
            { symbol: 'GPT', category: '12) Other' },
            { symbol: 'FLOW', category: '01) Chain' },
            { symbol: 'MEME', category: '09) NFT' },
            { symbol: 'APE', category: '09) NFT' },
            { symbol: 'STG', category: '06) Layer 0' }
        ];

        // 獲取表格數據
        function getTableData() {
            const dataContainer = document.getElementById('data');
            dataContainer.innerHTML = '';

            const promises = symbols.map(({ symbol }) => get_symbol_price(symbol));

            Promise.all(promises)
                .then(results => {
                    const data = [];

                    results.forEach((result, index) => {
                        const [last_price, price_change_percent] = result;
                        const { symbol, category } = symbols[index];

                        if (last_price !== null && price_change_percent !== null) {
                            const priceChangePercentFormatted = price_change_percent > 0
                                ? (price_change_percent < 10 ? `+${price_change_percent}` : `+${price_change_percent}`)
                                : (price_change_percent > -10 ? ` ${price_change_percent}` : price_change_percent);

                            data.push({
                                category,
                                symbol,
                                last_price,
                                price_change_percent: priceChangePercentFormatted
                            });
                        }
                    });

                    data.sort((a, b) => {
                        if (a.category !== b.category) {
                            return a.category.localeCompare(b.category);
                        } else {
                            return parseFloat(b.price_change_percent) - parseFloat(a.price_change_percent);
                        }
                    });

                    data.forEach(({ category, symbol, last_price, price_change_percent }) => {
                        const row = document.createElement('tr');
                        const priceChangeClass = parseFloat(price_change_percent) > 0 ? 'positive' : 'negative';
                        row.innerHTML = `
                            <td>${category}</td>
                            <td>${symbol}</td>
                            <td>${last_price}</td>
                            <td class="${priceChangeClass}">${price_change_percent}%</td>
                        `;
                        dataContainer.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // 初始化
        getTableData();
        setInterval(getTableData, 60000); // 每分鐘更新一次
    </script>
</body>
</html>
